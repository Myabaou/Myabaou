---
title: "[AWS]CLIä¾¿åˆ©ã‚³ãƒãƒ³ãƒ‰"
emoji: "ğŸ§‘â€ğŸ’»"
type: "tech"
topics: ["aws"]
published: true
---
è¤‡æ•°AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆé‹ç”¨ã—ã¦ã„ã¦EC2ã‚„RDSã®çŠ¶æ…‹ã‚’ç¢ºèªã—ãŸã„å ´åˆã€
- ãƒãƒãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ« ï¼ˆAWSã€€SSOé‹ç”¨ã§ã‚‚ï¼‰ãƒ­ã‚°ã‚¤ãƒ³ã—ãªãŠã™ã®ãŒé¢å€’
- CLI ã‚³ãƒãƒ³ãƒ‰ã‚’èª¿ã¹ã‚‹ã®ãŒé¢å€’ ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’`alias` ã‹ `/usr/local/bin`ãªã©ã§ç™»éŒ²ã—ã¦ã‚ã‚‹ã¨ç¢ºèªãŒæ¥½ã€‚

## å‰ææ¡ä»¶
- aws cli v2 ï¼ˆv1ã§ã‚‚å‹•ãã‹ã‚‚ã—ã‚Œãªã„ãŒæœªæ¤œè¨¼ï¼‰
- jq ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆ

## EC2ä¸€è¦§

```bash
aws ec2 describe-instances  \
|       jq -r '.[][].Instances[]
         | [[.Tags[] | select(.Key == "Name").Value][],
            .InstanceId,
            .PrivateIpAddress,
            .InstanceType,
            .LaunchTime,
            .State.Name,
            .PublicIpAddress
            ]
         | @tsv' | \
         column -t
```

## RDSä¸€è¦§

```bash
echo "======= RDS Cluster =========="
aws rds describe-db-clusters | \
jq -r '.[][]
| [.DBClusterIdentifier,
.Status,
.Endpoint]
| @tsv' | \
column -t

echo "======= RDS Instance =========="
aws rds describe-db-instances | \
    jq -r '.[][]
         | [.DBInstanceIdentifier,
            .DBInstanceClass,
            .DBClusterIdentifier,
            .DBInstanceStatus]
         | @tsv' | \
    column -t


echo "==== RDS Writer Instance ===="
aws rds describe-db-clusters --query "DBClusters[].[DBClusterIdentifier,DBClusterMembers[].[DBInstanceIdentifier,IsClusterWriter]]" --output text
```

## ElastiCacheä¸€è¦§

```bash
aws elasticache describe-cache-clusters | \
    jq -r '.[][]
         | [.CacheClusterId,
            .CacheNodeType,
            .CacheClusterStatus,
            .ReplicationGroupId]
         | @tsv' | \
    column -t
```

---

# ãŠã¾ã‘
## RI/SavingsPlansä¸€è¦§
```bash
#!/bin/bash

echo " =========== EC2 RI ç¢ºèª ============="
aws ec2 describe-reserved-instances \
  | jq -r '.ReservedInstances[] |
  [
	  .InstanceType,
	  .InstanceCount,
	  .Start,
	  .End,
      .State
	  ] | @tsv' | \
         column -t | sort -k5


echo " =========== RDS RI ç¢ºèª ============="
aws rds describe-reserved-db-instances \
  | jq -r '.ReservedDBInstances[] |
  [
.DBInstanceClass,
.DBInstanceCount,
.StartTime,
.Duration,
.State
	  ] | @tsv' | \
         column -t | sort -k5


echo " =========== ElastiCache RI ç¢ºèª ============="
aws elasticache describe-reserved-cache-nodes \
  | jq -r '.ReservedCacheNodes[] |
  [
.CacheNodeType,
.CacheNodeCount,
.StartTime,
.Duration,
.State
	  ] | @tsv' | \
         column -t | sort -k5



echo " =========== OpenSearch RI ç¢ºèª ============="
aws opensearch describe-reserved-instances \
  | jq -r '.ReservedInstances[] |
  [
.InstanceType,
.InstanceCount,
.StartTime,
.Duration,
.State
	  ] | @tsv' | \
         column -t | sort -k5

echo " =========== SavingsPlansç¢ºèª ============="
_DATE=$(date +%Y-%m-%d)
_DATE_1Y=$(date -v-1y +%Y-%m-%d)
aws ce get-savings-plans-utilization-details --time-period Start=${_DATE_1Y},End=${_DATE} | jq -r '.SavingsPlansUtilizationDetails[].Attributes |
[
.InstanceFamily,
.HourlyCommitment,
.StartDateTime,
.EndDateTime,
.Status
] | @tsv'
```